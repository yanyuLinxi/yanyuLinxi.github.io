---
title: "Lightgbm面试题相关"
date: 2022-03-04T11:01:50+08:00
tags : [

]
categories : [

]
series : []
aliases : []
draft: false
---

# lightgbm

从 LightGBM 名字我们可以看出其是轻量级（Light）的梯度提升机（GBM），其相对 XGBoost 具有训练速度快、内存占用低的特点。

LightGBM 是为解决GBDT训练速度慢，内存占用大的缺点，此外还提出了：

基于Histogram的决策树算法

单边梯度采样 Gradient-based One-Side Sampling(GOSS)

互斥特征捆绑 Exclusive Feature Bundling(EFB)

带深度限制的Leaf-wise的叶子生长策略

直接支持类别特征(Categorical Feature)

支持高效并行

Cache命中率优化

lgbm特点：
1. 直方图算法
   1. 将大规模数据放在直方图中，将数据划分成若干个区间。将每个区间的值更新为箱子的值。
   2. 优点：内存占用小，计算代价小。直方图做差加速
   3. 相比xgb不需要额外存储预排序，且只保存特征离散化后的值(整型)
   4. 相比xgb不需要遍历一个特征值就需要计算一次分裂的增益，只需要计算k次(k为箱子的个数)
   5. 一个叶子的直方图可以由它的父亲节点的直方图与它兄弟的直方图做差得到，在速度上可以提升一倍
2. 采用leaf-wise算法
   1. XGBoost 采用 Level-wise，策略遍历一次数据可以同时分裂同一层的叶子，容易进行多线程优化
   2. LightGBM采用Leaf-wise的增长策略，该策略每次从当前所有叶子中，找到分裂增益最大的一个叶子，然后分裂
   3. 区别：
      1. 优点：因此同Level-wise相比，Leaf-wise的优点是：在分裂次数相同的情况下，Leaf-wise可以降低更多的误差，得到更好的精度
      2. 缺点：可能会长出比较深的决策树，产生过拟合。
3. 单边梯度采样
   1. GOSS算法从减少样本的角度出发，排除大部分小梯度的样本，仅用剩下的样本计算信息增益。
   2. 为了不改变数据的总体分布，GOSS对要进行分裂的特征按照绝对值大小进行排序，选取最大的a个数据，在剩下梯度小的数据中选取b个，这b个数据乘以权重(1−a)/b,最后使用这a+b个数据计算信息增益。
   3. a个大梯度+b个小梯度*(1-a)/b
4. 互斥特征捆绑算法(EFB)
   1. 捆绑的特征是互斥的：即特征不会同时为非零值，像one-hot
      1. 如果两个特征并不是完全互斥（部分情况下两个特征都是非零值），可以用一个指标对特征不互斥程度进行衡量，称之为冲突比率，当这个值较小时，我们可以选择把不完全互斥的两个特征捆绑，而不影响最后的精度
   2. 互斥特征捆绑算法（Exclusive Feature Bundling, EFB）指出如果将一些特征进行融合绑定，则可以降低特征数量。
   3. 将互斥的特征进行捆绑（one-hot就是典型的互斥特征，选了其中一个，另一个不会被选择）
   4. 然后将他们的值域相加，如a的区域[0,10], b的取值[10,20]，则他么合并为[0, 20]
   5. 如何选择互斥特征（保证这些特征不同时为非零值。具体选择的算法是一种图着色问题，我还没有来得及弄懂）
5. LightGBM是怎么支持类别特征？（没看懂）
   1. 离散特征建立直方图的过程：统计该特征下每一种离散值出现的次数，并从高到低排序，并过滤掉出现次数较少的特征值, 然后为每一个特征值，建立一个bin容器。
   2. 分好桶之后，计算分裂阈值的过程
      1. 先看该特征下划分出的bin容器的个数，如果bin容器的数量小于4，直接使用one vs other方式, 逐个扫描每一个bin容器，找出最佳分裂点;
      2. 对于bin容器较多的情况, 先进行过滤，只让子集合较大的bin容器参加划分阈值计算, 对每一个符合条件的bin容器进行公式计算
      3. $\frac{该bin下样本一阶导之和}{该bin下样本二阶导之和}+正则项$
      4. 得到一个值，根据该值对bin容器从小到大进行排序，然后分从左到右、从右到左进行搜索，得到最优分裂阈值。但是有一点，没有搜索所有的bin容器，而是设定了一个搜索bin容器数量的上限值，程序中设定是32
   3. 对于连续特征，划分阈值只有一个，对于离散值可能会有多个划分阈值，每一个划分阈值对应着一个bin容器编号，当使用离散特征进行分裂时，只要数据样本对应的bin容器编号在这些阈值对应的bin集合之中，这条数据就加入分裂后的左子树，否则加入分裂后的右子树。
6. 支持高效并行

## 资料
1. https://zhuanlan.zhihu.com/p/99069186

## 面试题
1. lgbm优缺点
   1. 优点：
      1. 直方图降低了时间复杂度。降低了空间复杂度
      2. 单边梯度算法减少了计算量
      3. leaf-wise加强了精度，减少了计算量
      4. 互斥捆绑算法减少了特征数量，降低了内存消耗
   2. 缺点：
      1. leaf-wise容易过拟合
      2. 对噪点敏感。
2
